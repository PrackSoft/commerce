{% extends "auctions/layout.html" %}

{% block body %}

<div class="listings">
    <h3>{{ listing.title }}</h3>
    <p>{{ listing.description }}</p>
    <p>Current price: ${{ current_price }} by {{ current_owner }}</p>
    {% if listing.image_url %}
        <img src="{{ listing.image_url }}" alt="{{ listing.title }}">
    {% endif %}

    {% if request.user.is_authenticated and request.user == listing.owner and listing.is_active %}
    <form action="{% url 'close_auction' listing.id %}" method="post">
        {% csrf_token %}
        <button type="submit">Close Auction</button>
    </form>
    {% endif %}

    {% if show_message %}
        <p style="color:green">{{ message }}</p>
    {% endif %}

    {% if request.user.is_authenticated and request.user != listing.owner and listing.is_active %}
        <form method="post" action="{% url 'toggle_watchlist' listing.id %}">
            {% csrf_token %}
            <input type="submit" value="{% if is_watching %}Remove from Watchlist{% else %}Add to Watchlist{% endif %}">
        </form>
    {% endif %}

    {% if request.user.is_authenticated and request.user != listing.owner and listing.is_active %}
        <form method="post" action="{% url 'place_bid' listing.id %}">
            {% csrf_token %}
            <input type="number" step="0.01" name="bid_amount" placeholder="Enter your bid" required>
            <input type="submit" value="Place a Bid">
        </form>
        {% if error %}
            <p style="color:red">{{ error }}</p>
        {% endif %}
    {% endif %}

    {% if request.user.is_authenticated %}
        <form method="post" action="{% url 'add_comment' listing.id %}">
            {% csrf_token %}
            {{ form.text }}
            <input type="submit" value="Save">
        </form>
    {% endif %}
    <h3>Comments:</h3>
    {% for comment in comments %}
        <div>{{ comment.author }}: {{ comment.text }}</div>
    {% empty %}
        <p>No comments yet.</p>
    {% endfor %}

</div>

{% endblock %}
